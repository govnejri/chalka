

Цель: переход от скриптов к сервисам. Построение масштабируемых веб-приложений на Python, готовых к нагрузкам. Изучение современных фреймворков и инструментов деплоя.

---

### 4.1 Каркас модуля

Блоки
1. Асинхронный Python (AsyncIO)
2. FastAPI Framework
3. Валидация данных с Pydantic
4. SQLAlchemy и работа с ORM
5. Тестирование с Pytest
6. Контейнеризация (Docker)

Формат
- от простого сервера к микросервису
- внедрение практик продакшена (линтеры, тесты)
- финальный проект с деплоем в Docker Compose

---

### 4.2 Асинхронный Python (AsyncIO)

Фокус
- конкурентность против параллелизма
- блокирующие и неблокирующие вызовы
- синтаксис async await

Темы
- Event Loop, Coroutines, Tasks
- `async def`, `await`
- `asyncio.gather`, `asyncio.create_task`
- проблемы синхронного кода в асинхронном приложении
- асинхронные драйверы БД и HTTP клиенты

Задачи
- [ ] Написать скрипт, который скачивает 100 страниц последовательно и параллельно. Замерить разницу во времени
- [ ] Реализовать простую асинхронную очередь задач
- [ ] Написать чат-сервер на сокетах с использованием asyncio

---

### 4.3 FastAPI Framework

Фокус
- современный стандарт веб-разработки
- скорость и автоматическая документация
- обработка запросов

Темы
- роутинг и методы (GET, POST, etc.)
- Path parameters, Query parameters, Request Body
- Dependency Injection в FastAPI
- автоматическая документация Swagger UI / ReDoc
- обработка ошибок и Exception Handlers

Задачи
- [ ] Создать API с 3 эндпоинтами: hello world, calculator, echo
- [ ] Реализовать эндпоинт с загрузкой файла
- [ ] Сделать систему зависимостей для подключения к БД и проверки токенов

---

### 4.4 Валидация данных с Pydantic

Фокус
- строгая типизация данных
- валидация входных и выходных данных
- настройки конфигурации

Темы
- модели Pydantic `BaseModel`
- типы полей, валидаторы `field_validator`
- сериализация и десериализация
- настройки через `.env` файлы и `pydantic-settings`

Задачи
- [ ] Описать модели User, Post, Comment
- [ ] Добавить валидацию: пароль сложный, email корректный, возраст > 18
- [ ] Написать скрипт загрузки конфигурации из переменных окружения

---

### 4.5 SQLAlchemy и работа с ORM

Фокус
- работа с БД через объекты Python
- асинхронный доступ к данным
- миграции схемы

Темы
- Core vs ORM
- модели и маппинг таблиц
- сессии `AsyncSession`
- CRUD операции через ORM
- связи `relationship`, `back_populates`
- миграции с Alembic

Задачи
- [ ] Настроить подключение SQLAlchemy к PostgreSQL (асинхронно)
- [ ] Описать модели и сделать миграции через Alembic
- [ ] Реализовать функции для CRUD операций с пользователями и задачами
- [ ] Написать сложные запросы с JOIN и фильтрами через ORM

---

### 4.6 Тестирование с Pytest

Фокус
- качество кода
- модульные и интеграционные тесты
- фикстуры и моки

Темы
- написание тестов `def test_...`
- `assert` утверждения
- `pytest.fixture` для подготовки данных
- `conftest.py`
- тестирование API через `TestClient` или `AsyncClient`
- мокирование внешних сервисов

Задачи
- [ ] Написать unit тесты для функций бизнес-логики
- [ ] Написать интеграционные тесты для API эндпоинтов (с реальной или тестовой БД)
- [ ] Добиться покрытия кода тестами > 80% (проверка через `pytest-cov`)

---

### 4.7 Контейнеризация (Docker)

Фокус
- изоляция окружения
- воспроизводимость запуска
- оркестрация сервисов

Темы
- Dockerfile: `FROM`, `WORKDIR`, `COPY`, `RUN`, `CMD`
- образы и контейнеры
- docker-compose: описание сервисов (app, db)
- сети и тома (volumes) в Docker
- переменные окружения в контейнерах

Задачи
- [ ] Написать Dockerfile для FastAPI приложения (multistage build для оптимизации)
- [ ] Написать docker-compose.yml для поднятия приложения и PostgreSQL
- [ ] Запустить связку локально, проверить взаимодействие

---

### 4.8 Capstone Project: Task Manager API (Production Ready)

Идея
Полноценный бэкенд для таск-трекера с авторизацией, базой данных и документацией.

Требования
- REST API на FastAPI
- БД PostgreSQL, доступ через SQLAlchemy (async)
- Регистрация и аутентификация (JWT токены)
- CRUD для задач, пользователей
- Валидация данных Pydantic
- Покрытие тестами Pytest
- Полная упаковка в Docker Compose
- README с инструкцией по запуску

Этапы реализации
1. Проектирование схемы БД и API
2. Настройка окружения и репозитория
3. Реализация моделей БД и Pydantic схем
4. Реализация бизнес-логики и роутов
5. Добавление авторизации
6. Написание тестов
7. Упаковка в Docker
8. Финальное Code Review

Чек-лист сдачи
- [ ] Приложение запускается одной командой `docker-compose up`
- [ ] Проходят все тесты
- [ ] Доступна документация Swagger по `/docs`
- [ ] Код чистый, типизированный, проходит линтеры (ruff / flake8, mypy)
